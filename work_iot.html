<!DOCTYPE html>
<html lang="en" class="project-iot">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/portfolio/">
    <title>Ming Yang - IoT Plant Watering System</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="works.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo">
            <h1>Ming Yang</h1>
            <div class="social-icons">
                <a href="https://www.linkedin.com/in/myc208" target="_blank" aria-label="LinkedIn">
                    <img src="linkedin-icon.png" alt="LinkedIn" width="24" loading="lazy">
                </a>
                <a href="https://www.instagram.com/_ap.cr_" target="_blank" aria-label="Instagram">
                    <img src="instagram-icon.png" alt="Instagram" width="24" loading="lazy">
                </a>
            </div>
        </div>
        <button class="menu-toggle" aria-label="Toggle navigation" aria-expanded="false">
            &#9776;
        </button>
        <nav class="nav-links">
            <a href="index.html">About</a>
            <a href="works.html" class="active">Works</a>
            <label class="switch">
              <input type="checkbox" id="theme-toggle" aria-label="Toggle dark mode">
              <span class="slider-ios"></span>
            </label>             
        </nav>
    </header>

    <div class="nav-orb" id="navOrb">
        <i class="fas fa-bars"></i>
    </div>

    <div class="nav-sphere" id="navSphere">
        <a href="work_hnn.html"><i class="fas fa-brain"></i> Hybrid Neural Network</a>
        <a href="work_elastic.html"><i class="fas fa-database"></i> ElasticSearch DB</a>
        <a href="work_cnn.html"><i class="fas fa-eye"></i> Convolutional NN</a>
        <a href="work_rnn.html"><i class="fas fa-language"></i> Recurrent NN</a>
        <a href="work_aa.html"><i class="fas fa-chart-line"></i> Storyboard Mapping</a>
        <a href="work_fse.html"><i class="fas fa-file-excel"></i> Excel Engineering</a>
        <a href="work_dv.html"><i class="fas fa-chart-pie"></i> Data Visualization</a>
        <a href="work_cs.html"><i class="fas fa-code"></i> C# Application</a>
        <a href="work_grade.html"><i class="fas fa-graduation-cap"></i> Grades Database</a>
        <a href="work_gwent.html"><i class="fas fa-gamepad"></i> Gwent Game</a>
        <a href="work_socket.html"><i class="fas fa-plug"></i> Socket Programming</a>
        <a href="work_iot.html" class="active"><i class="fas fa-seedling"></i> IoT Plant Watering System</a>
    </div>

    <div class="container">
        <div class="project-header">
            <h1 class="project-title">IoT Plant Watering System</h1>
            <p class="project-summary">A scalable group-based IoT project for smart plant irrigation, featuring 3D-printed hardware, sensors, and a web dashboard for remote monitoring and control.</p>
        </div>

        <div class="project-description project-section">
            <h2>Project Description</h2>
            <p>This group project developed a smart plant irrigation system using Raspberry Pi and sensors to automate watering based on soil moisture levels. The system includes a 3D-printed water dispensing tube for even distribution, a mini motor for valve control, soil moisture sensor, water reservoir with level monitoring, and a web dashboard for remote access. Users can view reservoir status, moisture readings, manually override watering, and set intervals. It's designed for scalability and ease of use anywhere.</p>
        </div>

        <div class="project-technologies project-section">
            <h2>Technologies Used</h2>
            <div class="tech-grid">
                <div class="tech-item">
                    <i class="fab fa-python"></i>
                    <span>Python</span>
                </div>
                <div class="tech-item">
                    <i class="fas fa-microchip"></i>
                    <span>Raspberry Pi</span>
                </div>
                <div class="tech-item">
                    <i class="fas fa-cloud"></i>
                    <span>MQTT</span>
                </div>
                <div class="tech-item">
                    <i class="fas fa-database"></i>
                    <span>SQLite</span>
                </div>
                <div class="tech-item">
                    <i class="fas fa-tools"></i>
                    <span>Hardware Sensors/Servo</span>
                </div>
            </div>
        </div>

        <div class="project-features project-section">
            <h2>Key Features</h2>
            <div class="features-grid">
                <div class="feature-item animate-on-scroll">
                    <i class="fas fa-tint"></i>
                    <h3>Moisture Monitoring</h3>
                    <p>Real-time soil moisture readings via sensor, triggering automatic watering.</p>
                </div>
                <div class="feature-item animate-on-scroll">
                    <i class="fas fa-water"></i>
                    <h3>Water Level Detection</h3>
                    <p>Alerts when reservoir is low; shows empty/filled status on dashboard.</p>
                </div>
                <div class="feature-item animate-on-scroll">
                    <i class="fas fa-sliders-h"></i>
                    <h3>Manual Override</h3>
                    <p>Remote control to open/close valve and set watering intervals.</p>
                </div>
                <div class="feature-item animate-on-scroll">
                    <i class="fas fa-database"></i>
                    <h3>Data Logging</h3>
                    <p>SQLite database logs moisture and valve states for analysis.</p>
                </div>
                <div class="feature-item animate-on-scroll">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3>MQTT Integration</h3>
                    <p>Publishes sensor data and receives control commands via MQTT.</p>
                </div>
            </div>
        </div>

        <div class="project-code project-section">
            <h2>Code Implementation</h2>
            <div class="code-examples">
                <div class="code-example animate-on-scroll">
                    <h3>Main Logic (new_irrigation_system.py)</h3>
                    <pre><code class="language-python">
#!/usr/bin/env python3
import time
import sqlite3
import spidev
import pigpio
import paho.mqtt.client as mqtt
from threading import Lock, Thread
from queue import Queue
import RPi.GPIO as GPIO

# Hardware Configuration
SERVO_GPIO = 18
ADC_CHANNEL = 0
DRY_THRESHOLD = 300
WET_THRESHOLD = 700
SENSOR_PIN = 21  # Water level sensor GPIO pin

# MQTT Configuration
MQTT_BROKER = "localhost"
MOISTURE_TOPIC = "irrigation/moisture"
STATE_TOPIC = "irrigation/state"
CONTROL_TOPIC = "irrigation/control"
WATER_LEVEL_TOPIC = "irrigation/water_level"  # Topic for water level warning

# Global Resources
pi = None
spi = None
db_queue = Queue()
override_lock = Lock()
override_active = False
override_start_time = 0
water_level_low = False

# Initialize hardware (servo and SPI)
def initialize_hardware():
    global pi, spi
    try:
        pi = pigpio.pi()
        if not pi.connected:
            raise ConnectionError("Pigpio daemon connection failed")
        
        spi = spidev.SpiDev()
        spi.open(0, 0)
        spi.max_speed_hz = 1000000
        
        pi.set_servo_pulsewidth(SERVO_GPIO, 2500)  # Start closed
        time.sleep(0.5)
        return True
    except Exception as e:
        print(f"Hardware Error: {str(e)}")
        return False

# Database worker to log data
def db_worker():
    conn = sqlite3.connect('irrigation.db', check_same_thread=False)
    conn.execute("PRAGMA journal_mode = WAL")
    c = conn.cursor()
    while True:
        query, params = db_queue.get()
        try:
            c.execute(query, params)
            conn.commit()
        except sqlite3.Error as e:
            print(f"Database Error: {str(e)}")
            conn.rollback()
        db_queue.task_done()

Thread(target=db_worker, daemon=True).start()

db_queue.put((
    '''CREATE TABLE IF NOT EXISTS sensor_data (
        timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
        moisture INTEGER,
        valve_state TEXT
    )''', 
    ()
))

# Log data into the database
def log_data(moisture, state):
    db_queue.put((
        "INSERT INTO sensor_data (moisture, valve_state) VALUES (?,?)",
        (moisture, state)
    ))

# Read moisture level
def read_moisture():
    try:
        adc = spi.xfer2([1, (8 + ADC_CHANNEL) << 4, 0])
        return ((adc[1] & 3) << 8) + adc[2]
    except Exception as e:
        print(f"Sensor Error: {str(e)}")
        return -1

# Set the valve state (open or close)
def set_valve(state):
    try:
        pulse = 500 if state == "open" else 2500
        pi.set_servo_pulsewidth(SERVO_GPIO, pulse)
        print(f"VALVE ACTION: {state.upper()} (Pulse: {pulse}Î¼s)")
        client.publish(STATE_TOPIC, state)
    except Exception as e:
        print(f"Valve Error: {str(e)}")

# MQTT callback for incoming control messages
def mqtt_callback(client, userdata, msg):
    try:
        payload = msg.payload.decode('utf-8').lower()
        print(f"CONTROL RECEIVED: {payload}")
        if msg.topic == CONTROL_TOPIC:
            if payload in ["open", "close"]:
                print(f"VALID COMMAND: {payload}")
                with override_lock:
                    override_active = True
                    override_start_time = time.time()
                    set_valve(payload)
    except Exception as e:
        print(f"MQTT ERROR: {str(e)}")

# Initialize MQTT client
client = mqtt.Client()
client.connect(MQTT_BROKER)
client.subscribe(CONTROL_TOPIC)
client.on_message = mqtt_callback
client.loop_start()

# Water level sensor logic
def water_level_check():
    global water_level_low
    GPIO.setwarnings(False)
    GPIO.setmode(GPIO.BCM)
    GPIO.setup(SENSOR_PIN, GPIO.IN)

    while True:
        if GPIO.input(SENSOR_PIN) == GPIO.HIGH:  # If HIGH, water is low
            water_level_low = True
            print("Water level is LOW!")
            client.publish(WATER_LEVEL_TOPIC, "Water level is low! Please refill.")
        else:  # If LOW, water is high
            water_level_low = False
            print("Water level is HIGH!")
            client.publish(WATER_LEVEL_TOPIC, "Water level is sufficient.")
        time.sleep(5)

# Start the water level check in a separate thread
Thread(target=water_level_check, daemon=True).start()

try:
    if not initialize_hardware():
        exit(1)

    while True:
        moisture = read_moisture()
        if moisture != -1:
            client.publish(MOISTURE_TOPIC, str(moisture))
            print(f"Moisture: {moisture}/1023")

        # Handle override for valve control
        with override_lock:
            current_active = override_active
            current_start = override_start_time

        if current_active:
            if time.time() - current_start >= 10:
                with override_lock:
                    override_active = False
                    print("Override ended")
                if moisture >= WET_THRESHOLD:
                    set_valve("close")
                elif moisture <= DRY_THRESHOLD:
                    set_valve("open")
        else:
            if moisture <= DRY_THRESHOLD:
                set_valve("open")
            elif moisture >= WET_THRESHOLD:
                set_valve("close")
                
        # Log data with valve state
        log_data(moisture, "open" if pi.get_servo_pulsewidth(SERVO_GPIO) == 500 else "close")
        time.sleep(1)

except KeyboardInterrupt:
    print("\nCleaning up...")
    if pi and pi.connected:
        pi.set_servo_pulsewidth(SERVO_GPIO, 0)
        pi.stop()
    if spi:
        spi.close()
    db_queue.join()
    print("Cleanup complete")
    GPIO.cleanup()
                    </code></pre>
                </div>
            </div>
        </div>

        <div class="project-gallery project-section">
            <h2>Project Gallery</h2>
            <div class="gallery-grid">
                <div class="gallery-item animate-on-scroll">
                    <img src="iot_poster.png" alt="Project Poster">
                    <p class="image-caption">Project Poster Overview</p>
                </div>
                <div class="gallery-item animate-on-scroll">
                    <img src="iot_product.png" alt="Product Image">
                    <p class="image-caption">Physical Product Setup</p>
                </div>
                <div class="gallery-item animate-on-scroll">
                    <img src="iot_dashboard.png" alt="Dashboard Screenshot">
                    <p class="image-caption">Web Dashboard Interface</p>
                </div>
            </div>
        </div>

        <div class="project-video project-section">
            <h2>Presentation Recording</h2>
            <video controls>
                <source src="iot_presentation.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>

        <div class="project-links project-section">
            <a href="http://115.66.63.6:1880/ui" target="_blank" class="drive-button">
                <i class="fas fa-external-link-alt"></i>
                View Dashboard
            </a>
        </div>

        <div class="project-lessons project-section">
            <h2>Key Learnings</h2>
            <div class="lessons-grid">
                <div class="lesson-item animate-on-scroll">
                    <i class="fas fa-microchip"></i>
                    <h3>Hardware-Software Integration</h3>
                    <p>Learned to interface sensors and actuators with Raspberry Pi for real-time control.</p>
                </div>
                <div class="lesson-item animate-on-scroll">
                    <i class="fas fa-cloud"></i>
                    <h3>IoT Scalability</h3>
                    <p>Designed a system that's small yet expandable, using MQTT for remote monitoring.</p>
                </div>
                <div class="lesson-item animate-on-scroll">
                    <i class="fas fa-users"></i>
                    <h3>Team Collaboration</h3>
                    <p>Coordinated hardware design, coding, and testing in a group setting.</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Ming Yang. You can't use up creativity, the more you use, the more you have in your significant mind.</p>
    </footer>

    <script src="scripts.js"></script>
    <script src="works.js"></script>
</body>
</html>